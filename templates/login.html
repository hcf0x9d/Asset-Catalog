<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login</title>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>

    <script src="//apis.google.com/js/client:platform.js?onload=start"> </script>
</head>
<body>
<!-- ======================================================================= -->
<!-- Google Plus Sign-in Button ============================================ -->

    <div id="signInButton">
        <span class="g-signin"
            data-scope="openid email"
            data-clientid="530059986349-lcvlabr7u7uig58vsimpioj00t17vlit.apps.googleusercontent.com"
            data-redirecturi="postmessage"
            data-accesstype="offline"
            data-cookiepolicy="single_host_origin"
            data-callback="signInCallback"
            data-approvalprompt="force">
        </span> <!-- Disable the data-approvalprompt=force for production -->
    </div>
<!-- ======================================================================= -->


    <div id="result"></div>



    <script>

        function signInCallback( authResult ) {
            if ( authResult[ 'code' ] ) {

                $( '#signInButton' ).attr( 'style', 'display:none' );

                $.ajax( {
                    type: 'POST',
                    url: '/gconnect?state={{STATE}}',
                    processData: false,
                    contentType: 'application/octet-stream; charset=UTF-8',
                    data: authResult[ 'code' ],
                    success: function ( result ) {
                        if ( result ) {

                            $( '#result' ).html( 'Login Successful!<br>' + result + '<br>Redirecting...' )

                            setTimeout( function () {
                                window.location.href = '/';
                            }, 4000 );

                        } else if ( authResult[ 'error' ] ) {

                            console.log( 'An error occurred :: ' + authResult[ 'error' ])

                        } else {

                            $( '#result' ).html( 'Failed miserably, panic and scream' );

                        }
                    }
                } );
            }
        }
    </script>
</body>
</html>